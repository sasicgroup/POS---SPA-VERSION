(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43531,e=>{"use strict";let s=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>s],43531)},56909,e=>{"use strict";let s=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>s],56909)},72560,e=>{"use strict";var s=e.i(43476),a=e.i(94690),t=e.i(71645),l=e.i(56909),i=e.i(43531),d=e.i(7471),r=e.i(81239);function o(){let{activeStore:e,user:o,updateRolePermissions:n}=(0,a.useAuth)(),{showToast:c}=(0,r.useToast)(),[m,b]=(0,t.useState)("permissions"),[x,u]=(0,t.useState)("manager"),[g,h]=(0,t.useState)(a.DEFAULT_PERMISSIONS);(0,t.useEffect)(()=>{e?.rolePermissions&&Object.keys(e.rolePermissions).length>0?h(e.rolePermissions):h(a.DEFAULT_PERMISSIONS||{})},[e]);let[p,f]=(0,t.useState)([]),[v,j]=(0,t.useState)([]),[w,y]=(0,t.useState)({});(0,t.useEffect)(()=>{"access"===m&&k()},[m]);let k=async()=>{let{data:e}=await d.supabase.from("employees").select("*");e&&f(e);let{data:s}=await d.supabase.from("stores").select("*");s&&j(s);let{data:a}=await d.supabase.from("employee_access").select("*");if(a){let e={};a.forEach(s=>{e[s.employee_id]||(e[s.employee_id]=[]),e[s.employee_id].push(s.store_id)}),y(e)}},N=async(e,s,a)=>{if(a){let{error:a}=await d.supabase.from("employee_access").delete().match({employee_id:e,store_id:s});a||y(a=>({...a,[e]:a[e].filter(e=>e!==s)}))}else{let{error:a}=await d.supabase.from("employee_access").insert({employee_id:e,store_id:s,role:"staff"});a||y(a=>({...a,[e]:[...a[e]||[],s]}))}},_=async()=>{if(!n)return;let e=!0;for(let s of(await n(x,g[x])||(e=!1),Object.keys(g).filter(e=>"owner"!==e&&e!==x)))await n(s,g[s])||(e=!1);e?c("success","Permissions saved successfully"):c("error","Failed to save permissions. Ensure you have the latest database schema.")};return e&&o?(0,s.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Roles & Permissions"}),(0,s.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Manage access levels and multi-store assignments."})]}),"permissions"===m&&(0,s.jsxs)("button",{onClick:_,className:"flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-indigo-700 active:bg-indigo-800 shadow-lg shadow-indigo-500/30",children:[(0,s.jsx)(l.Save,{className:"h-4 w-4"}),"Save Changes"]})]}),(0,s.jsxs)("div",{className:"flex gap-4 border-b border-slate-200 dark:border-slate-800",children:[(0,s.jsx)("button",{onClick:()=>b("access"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${"access"===m?"border-indigo-600 text-indigo-600 dark:text-indigo-400":"border-transparent text-slate-500 hover:text-slate-700"}`,children:"Store Access"}),(0,s.jsx)("button",{onClick:()=>b("permissions"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${"permissions"===m?"border-indigo-600 text-indigo-600 dark:text-indigo-400":"border-transparent text-slate-500 hover:text-slate-700"}`,children:"Role Permissions"})]}),"access"===m?(0,s.jsx)("div",{className:"grid gap-6 md:grid-cols-1",children:(0,s.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900 overflow-hidden",children:[(0,s.jsx)("div",{className:"border-b border-slate-200 bg-slate-50 px-6 py-4 dark:border-slate-800 dark:bg-slate-800/50",children:(0,s.jsx)("h3",{className:"font-semibold text-slate-900 dark:text-slate-100",children:"Staff Store Assignment"})}),(0,s.jsxs)("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:[p.map(e=>(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 font-bold",children:e.name.substring(0,2).toUpperCase()}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-bold text-slate-900 dark:text-white",children:e.name}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:[e.role," â€¢ ",e.email||"No Email"]})]})]})}),(0,s.jsxs)("div",{className:"pl-14",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Accessible Stores:"}),(0,s.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:v.map(a=>{let t=w[e.id]?.includes(a.id);return(0,s.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${t?"bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800":"bg-slate-50 border-slate-200 dark:bg-slate-800/50 dark:border-slate-700"}`,children:[(0,s.jsx)("input",{type:"checkbox",checked:!!t,onChange:()=>N(e.id,a.id,!!t),className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"}),(0,s.jsx)("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-200 flex-1 truncate",children:a.name}),t&&(0,s.jsx)(i.Check,{className:"h-4 w-4 text-indigo-600"})]},a.id)})})]})]},e.id)),0===p.length&&(0,s.jsx)("div",{className:"p-8 text-center text-slate-500",children:"No employees found."})]})]})}):(0,s.jsx)("div",{className:"rounded-xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900",children:(0,s.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,s.jsx)("div",{className:"w-full lg:w-64 flex-shrink-0 space-y-2",children:["owner","manager","staff"].map(e=>(0,s.jsx)("button",{onClick:()=>u(e),className:`w-full text-left px-4 py-3 rounded-lg border transition-all ${x===e?"bg-indigo-50 border-indigo-200 text-indigo-700 dark:bg-indigo-900/20 dark:border-indigo-800":"border-transparent hover:bg-slate-50"}`,children:(0,s.jsx)("div",{className:"font-medium",children:{owner:"Owner",manager:"Manager",staff:"Staff"}[e]})},e))}),(0,s.jsx)("div",{className:"flex-1 bg-slate-50 rounded-xl p-6 border border-slate-100 dark:bg-slate-800/20",children:(0,s.jsx)("div",{className:"grid gap-6 md:grid-cols-2",children:[{module:"Dashboard",actions:[{id:"view_dashboard",label:"View Dashboard"},{id:"view_analytics",label:"View Analytics & Reports"}]},{module:"Inventory",actions:[{id:"view_inventory",label:"View Inventory"},{id:"add_product",label:"Add Products"},{id:"edit_product",label:"Edit Products"},{id:"delete_product",label:"Delete Products"},{id:"adjust_stock",label:"Adjust Stock Levels"}]},{module:"Sales (POS)",actions:[{id:"access_pos",label:"Access POS"},{id:"process_returns",label:"Process Returns"},{id:"give_discount",label:"Give Discounts"},{id:"view_sales_history",label:"View Sales History"}]},{module:"Customers",actions:[{id:"view_customers",label:"View Customers"},{id:"manage_customers",label:"Add/Edit/Delete Customers"}]},{module:"Employees",actions:[{id:"view_employees",label:"View Employees"},{id:"manage_employees",label:"Manage Employees & Roles"}]},{module:"Settings",actions:[{id:"access_settings",label:"Access Store Settings"},{id:"view_roles",label:"View Roles"},{id:"manage_roles",label:"Manage Roles"}]}].map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 p-4 dark:bg-slate-900 shadow-sm",children:[(0,s.jsx)("h4",{className:"font-semibold mb-3",children:e.module}),(0,s.jsx)("div",{className:"space-y-2",children:e.actions.map(e=>{var a;return(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:(a=e.id,"owner"===x||g?.[x]?.[a]===!0),onChange:()=>{var s;return s=e.id,void h(e=>{let a=e?.[x]||{};return{...e,[x]:{...a,[s]:!a[s]}}})},disabled:"owner"===x||"super_admin"===x,className:"rounded text-indigo-600 cursor-pointer disabled:opacity-50"}),(0,s.jsx)("span",{className:"text-sm",children:e.label})]},e.id)})})]},e.module))})})]})})]}):null}e.s(["default",()=>o])}]);