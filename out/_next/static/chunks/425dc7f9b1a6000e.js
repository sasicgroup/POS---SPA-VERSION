(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},27612,e=>{"use strict";let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],27612)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},87130,e=>{"use strict";let t=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},78583,e=>{"use strict";let t=(0,e.i(75254).default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],78583)},40160,e=>{"use strict";let t=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],40160)},66197,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(55436),l=e.i(87316),r=e.i(87130),d=e.i(75254);let i=(0,d.default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),n=(0,d.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var c=e.i(37727),o=e.i(78583),x=e.i(40160),m=e.i(84614),h=e.i(88844),u=e.i(27612),p=e.i(7471),b=e.i(94690),g=e.i(81239);function j(){let{activeStore:e,user:d}=(0,b.useAuth)(),{showToast:j}=(0,g.useToast)(),[f,k]=(0,s.useState)([]),[y,N]=(0,s.useState)(""),[v,w]=(0,s.useState)(null),[S,C]=(0,s.useState)(null),[D,M]=(0,s.useState)([]),[T,_]=(0,s.useState)(!1),[A,z]=(0,s.useState)(!1),[H,L]=(0,s.useState)("all");(0,s.useEffect)(()=>{e?.id&&F()},[e?.id]);let F=async()=>{if(!e?.id)return;let{data:t,error:s}=await p.supabase.from("sales").select(`
                *,
                customers (name),
                employees (name)
            `).eq("store_id",e.id).order("created_at",{ascending:!1});s?console.error(s):t&&k(t)},U=async e=>{_(!0);let{data:t,error:s}=await p.supabase.from("sale_items").select(`
                *,
                products (name, sku)
            `).eq("sale_id",e);t&&M(t),_(!1)},P=async e=>{await p.supabase.from("sale_items").delete().eq("sale_id",e);let{error:t}=await p.supabase.from("sales").delete().eq("id",e);t?(console.error(t),j("error","Failed to delete record")):(k(f.filter(t=>t.id!==e)),j("success","Transaction record deleted permanently"),w(null))},I=f.filter(e=>(e.id.toString().includes(y)||e.customers?.name?.toLowerCase().includes(y.toLowerCase()))&&(e=>{if("all"===H)return!0;let t=new Date(e.created_at),s=new Date,a=e=>{let t=new Date;return t.setMonth(t.getMonth()-e),t};if("1d"===H)return t>=new Date(s.setHours(0,0,0,0));if("7d"===H){let e;return t>=((e=new Date).setDate(e.getDate()-7),e)}return"1m"===H?t>=a(1):"3m"===H?t>=a(3):"6m"===H?t>=a(6):"1y"!==H||t>=a(12)})(e));return(0,t.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Sales History"}),(0,t.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"View and manage past transactions."})]}),(0,t.jsxs)("div",{className:"flex gap-2 relative",children:[(0,t.jsxs)("button",{onClick:()=>z(!A),className:`flex items-center gap-2 rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${A?"bg-slate-100 border-slate-300 dark:bg-slate-800":"bg-white border-slate-200 hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300"}`,children:[(0,t.jsx)(r.Filter,{className:"h-4 w-4"}),"all"===H?"Filter":H.charAt(0).toUpperCase()+H.slice(1)]}),A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>z(!1)}),(0,t.jsx)("div",{className:"absolute top-12 right-0 z-20 w-48 rounded-xl border border-slate-200 bg-white p-1 shadow-xl dark:border-slate-800 dark:bg-slate-900",children:["all","1d","7d","1m","3m","6m","1y"].map(e=>(0,t.jsxs)("button",{onClick:()=>{L(e),z(!1)},className:`flex w-full items-center justify-between rounded-lg px-3 py-2 text-sm ${H===e?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-400":"text-slate-600 hover:bg-slate-50 dark:text-slate-400 dark:hover:bg-slate-800"}`,children:[(0,t.jsx)("span",{className:"capitalize",children:"all"===e?"All Time":"1d"===e?"Today":"7d"===e?"Last 7 Days":"1m"===e?"Last 30 Days":"3m"===e?"Last 3 Months":"6m"===e?"Last 6 Months":"Last Year"}),H===e&&(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})]},e))})]}),(0,t.jsxs)("button",{onClick:()=>{let e=new Blob([["Transaction ID,Date,Customer,Sold By,Amount,Payment,Status",...I.map(e=>[e.id,new Date(e.created_at).toLocaleDateString(),e.customers?.name||"Guest",e.employees?.name||"Unknown",e.total_amount,e.payment_method,e.status]).map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.setAttribute("download",`sales_history_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s)},className:"flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300",children:[(0,t.jsx)(x.Download,{className:"h-4 w-4"})," Export"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900",children:[(0,t.jsx)(a.Search,{className:"h-5 w-5 text-slate-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Search by ID, customer, employee...",className:"flex-1 bg-transparent text-sm outline-none placeholder:text-slate-400 dark:text-white",value:y,onChange:e=>N(e.target.value)})]}),(0,t.jsx)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden dark:border-slate-800 dark:bg-slate-900",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50 text-slate-500 dark:bg-slate-800/50 dark:text-slate-400",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Transaction ID"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Date & Time"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Customer"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Sold By"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Amount"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Payment"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-4 font-medium text-right",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:0===I.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:8,className:"px-6 py-8 text-center text-slate-500",children:"No sales records found."})}):I.map(e=>(0,t.jsxs)("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[(0,t.jsxs)("td",{className:"px-6 py-4 font-mono text-xs text-slate-500",children:[e.id.toString().slice(0,8),"..."]}),(0,t.jsx)("td",{className:"px-6 py-4 text-slate-700 dark:text-slate-300",children:new Date(e.created_at).toLocaleString()}),(0,t.jsx)("td",{className:"px-6 py-4 text-slate-900 font-medium dark:text-white",children:e.customers?.name||"Guest"}),(0,t.jsx)("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-400",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-bold dark:bg-indigo-900/30 dark:text-indigo-400",children:(e.employees?.name||"U").charAt(0)}),e.employees?.name||"Unknown"]})}),(0,t.jsxs)("td",{className:"px-6 py-4 font-bold text-slate-900 dark:text-white",children:["GHS ",e.total_amount.toFixed(2)]}),(0,t.jsx)("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-400 capitalize",children:e.payment_method}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize ${"Completed"===e.status||"completed"===e.status?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400":"bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400"}`,children:e.status})}),(0,t.jsxs)("td",{className:"px-6 py-4 text-right",children:[(0,t.jsx)("button",{onClick:()=>{C(e),U(e.id)},className:"text-slate-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors bg-slate-100 p-2 rounded-full hover:bg-indigo-50 dark:bg-slate-800 dark:hover:bg-indigo-900/30",title:"View Details",children:(0,t.jsx)(n,{className:"h-4 w-4"})}),(d?.role==="owner"||d?.id==="owner-1")&&(0,t.jsx)("button",{onClick:()=>w(e),className:"text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors bg-slate-100 p-2 rounded-full hover:bg-red-50 dark:bg-slate-800 dark:hover:bg-red-900/30 ml-2",title:"Delete Record",children:(0,t.jsx)(u.Trash2,{className:"h-4 w-4"})})]})]},e.id))})]})})}),S&&(0,t.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in zoom-in-95 duration-200 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl overflow-hidden dark:bg-slate-900 max-h-[90vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 bg-slate-50/50 px-6 py-4 dark:border-slate-800 dark:bg-slate-800/50",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[(0,t.jsx)(o.FileText,{className:"h-5 w-5 text-indigo-500"}),"Transaction Details"]}),(0,t.jsxs)("p",{className:"text-xs text-slate-500 font-mono mt-1",children:["ID: ",S.id]})]}),(0,t.jsx)("button",{onClick:()=>C(null),className:"rounded-full p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-800 dark:hover:text-slate-200",children:(0,t.jsx)(c.X,{className:"h-5 w-5"})})]}),(0,t.jsxs)("div",{className:"p-6 overflow-y-auto flex-1",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1 block",children:"Customer"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 dark:bg-slate-800",children:(0,t.jsx)(m.User,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-slate-900 dark:text-white",children:S.customers?.name||"Guest Customer"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Retail Customer"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1 block",children:"Date & Time"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[(0,t.jsx)(l.Calendar,{className:"h-4 w-4"}),new Date(S.created_at).toLocaleString()]})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1 block",children:"Payment Info"}),(0,t.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-100 dark:bg-slate-800/50 dark:border-slate-800",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Method"}),(0,t.jsx)("span",{className:"font-semibold capitalize text-slate-900 dark:text-white",children:S.payment_method})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Status"}),(0,t.jsx)("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 uppercase",children:S.status})]})]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,t.jsx)(h.Package,{className:"h-4 w-4"})," Items Purchased"]}),(0,t.jsx)("div",{className:"rounded-xl border border-slate-200 overflow-hidden dark:border-slate-700",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-slate-50 text-slate-500 font-medium dark:bg-slate-800 dark:text-slate-400",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"Product"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"Price"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Qty"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"Total"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:T?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:4,className:"p-8 text-center text-slate-500",children:"Loading items..."})}):D.map((e,s)=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[(0,t.jsxs)("td",{className:"px-4 py-3 font-medium text-slate-700 dark:text-slate-200",children:[e.products?.name||"Unknown Item",(0,t.jsx)("div",{className:"text-xs text-slate-400 font-mono",children:e.products?.sku})]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right text-slate-600 dark:text-slate-400",children:["GHS ",e.price_at_sale.toFixed(2)]}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-slate-600 dark:text-slate-400",children:e.quantity}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right font-medium text-slate-900 dark:text-white",children:["GHS ",(e.price_at_sale*e.quantity).toFixed(2)]})]},s))}),(0,t.jsx)("tfoot",{className:"bg-slate-50 font-bold text-slate-900 dark:bg-slate-800 dark:text-white",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Total Amount"}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right text-indigo-600 dark:text-indigo-400 text-lg",children:["GHS ",S.total_amount.toFixed(2)]})]})})]})})]})]}),(0,t.jsxs)("div",{className:"p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3 dark:border-slate-800 dark:bg-slate-800",children:[(0,t.jsxs)("button",{onClick:()=>window.print(),className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-300 bg-white text-slate-700 hover:bg-slate-50 font-medium transition-colors dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200",children:[(0,t.jsx)(i,{className:"h-4 w-4"})," Print Receipt"]}),(0,t.jsx)("button",{onClick:()=>C(null),className:"px-6 py-2 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700 transition-colors",children:"Close"})]})]})}),v&&(0,t.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in zoom-in-95 duration-200 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-sm rounded-2xl bg-white p-6 shadow-2xl dark:bg-slate-900",children:[(0,t.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:(0,t.jsx)(u.Trash2,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),(0,t.jsx)("h3",{className:"text-lg font-bold text-center text-slate-900 dark:text-white mb-2",children:"Delete Transaction?"}),(0,t.jsxs)("p",{className:"text-sm text-center text-slate-500 mb-6",children:["Are you sure you want to delete transaction ",(0,t.jsxs)("span",{className:"font-mono font-medium",children:[v.id.toString().slice(0,8),"..."]}),"? This action cannot be undone."]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>w(null),className:"flex-1 rounded-xl bg-slate-100 py-3 font-medium text-slate-700 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-300",children:"Cancel"}),(0,t.jsx)("button",{onClick:()=>P(v.id),className:"flex-1 rounded-xl bg-red-600 py-3 font-bold text-white hover:bg-red-700",children:"Delete"})]})]})})]})}e.s(["default",()=>j],66197)}]);